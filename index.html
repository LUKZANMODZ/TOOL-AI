<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LC79 KITTY SQUARE - H·ªÜ TH·ªêNG KEY B·∫¢N M·ªöI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --pink: #ff66b2;
            --pink-light: #ff99cc;
            --pink-dark: #cc0066;
            --black: #111111;
            --black-light: #1a1a1a;
            --correct: #00ffaa;
            --wrong: #ff4477;
            --text: #ffeeff;
            --gold: #ffd700;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { 
            background: radial-gradient(circle at center, #330033, #000000); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            padding: 20px;
        }
        .square-container {
            width: 780px;
            height: 850px;
            background: linear-gradient(145deg, var(--black), #222222);
            border-radius: 40px;
            border: 8px solid var(--pink);
            box-shadow: 
                0 0 80px rgba(255, 102, 178, 0.8),
                inset 0 0 50px rgba(0, 0, 0, 0.9);
            padding: 30px;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .square-container::before {
            content: 'üîëüéÄüê±';
            font-size: 160px;
            position: absolute;
            bottom: -40px;
            right: -30px;
            opacity: 0.12;
            transform: rotate(15deg);
            z-index: 0;
        }
        .square-header {
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 4px dotted var(--pink);
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }
        .square-title {
            font-size: 2.8rem;
            color: var(--pink-light);
            text-shadow: 3px 3px 0 var(--pink-dark), 0 0 25px var(--pink);
            margin-bottom: 10px;
            letter-spacing: 1px;
        }
        .square-subtitle {
            color: var(--pink-light);
            font-size: 1.1rem;
            margin-bottom: 15px;
        }
        /* KEY SECTION */
        .key-section {
            background: rgba(255, 102, 178, 0.15);
            border-radius: 25px;
            border: 3px solid var(--pink);
            padding: 25px;
            margin-bottom: 25px;
            position: relative;
            z-index: 1;
            box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.4);
        }
        .key-title {
            color: var(--gold);
            font-size: 1.8rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .key-input-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        .key-input {
            flex: 1;
            padding: 18px 25px;
            border-radius: 20px;
            border: 3px solid var(--pink);
            background: rgba(0, 0, 0, 0.7);
            color: var(--text);
            font-size: 1.2rem;
            font-weight: bold;
            letter-spacing: 1px;
            outline: none;
        }
        .key-input:focus {
            border-color: var(--gold);
            box-shadow: 0 0 20px var(--gold);
        }
        .key-button {
            padding: 18px 35px;
            border-radius: 20px;
            border: none;
            background: linear-gradient(45deg, var(--pink), var(--pink-dark));
            color: white;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .key-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px var(--pink);
        }
        .key-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        .key-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding: 15px 20px;
            border-radius: 20px;
            background: rgba(0, 0, 0, 0.6);
        }
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
        }
        .status-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }
        .status-active { background: var(--correct); box-shadow: 0 0 15px var(--correct); }
        .status-inactive { background: var(--wrong); box-shadow: 0 0 15px var(--wrong); }
        .status-text { font-weight: bold; }
        /* MAIN CONTENT */
        .main-content {
            flex: 1;
            display: grid;
            grid-template-rows: 1fr 1fr;
            gap: 25px;
            position: relative;
            z-index: 1;
        }
        .prediction-section {
            background: rgba(255, 102, 178, 0.12);
            border-radius: 30px;
            border: 4px solid var(--pink);
            padding: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.5);
        }
        .prediction-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 40px;
            margin: 20px 0;
        }
        .prediction-circle {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            border: 10px solid;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5.5rem;
            font-weight: bold;
            box-shadow: 0 0 50px;
            background: rgba(0, 0, 0, 0.7);
            animation: pulse 3s infinite alternate;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 40px; }
            100% { box-shadow: 0 0 70px, 0 0 100px; }
        }
        .prediction-tai { border-color: var(--correct); color: var(--correct); box-shadow: 0 0 60px var(--correct) !important; }
        .prediction-xiu { border-color: var(--wrong); color: var(--wrong); box-shadow: 0 0 60px var(--wrong) !important; }
        .prediction-info {
            max-width: 320px;
        }
        .prediction-text {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--text);
        }
        .prediction-reason {
            color: var(--pink-light);
            font-size: 1.1rem;
            line-height: 1.4;
        }
        .verification-badge {
            background: rgba(0, 0, 0, 0.7);
            padding: 18px;
            border-radius: 20px;
            margin-top: 20px;
            border: 3px solid;
            text-align: center;
            width: 100%;
            max-width: 620px;
        }
        .verification-correct { border-color: var(--correct); background: rgba(0, 255, 170, 0.1); }
        .verification-wrong { border-color: var(--wrong); background: rgba(255, 68, 119, 0.1); }
        .verification-text {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        /* HISTORY SECTION */
        .history-section {
            background: rgba(26, 26, 26, 0.9);
            border-radius: 30px;
            border: 4px solid var(--pink-dark);
            padding: 25px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .history-title {
            color: var(--pink-light);
            font-size: 1.8rem;
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        .history-scroll {
            flex: 1;
            overflow-y: auto;
            padding-right: 15px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }
        .history-item {
            background: rgba(255, 102, 178, 0.1);
            border-radius: 20px;
            padding: 20px;
            border-left: 6px solid;
            text-align: center;
            transition: transform 0.3s;
        }
        .history-item:hover { transform: scale(1.05); }
        .history-item.tai { border-left-color: var(--correct); }
        .history-item.xiu { border-left-color: var(--wrong); }
        .session-id { color: var(--pink-light); font-size: 1.3rem; font-weight: bold; margin-bottom: 10px; }
        .session-dices { display: flex; justify-content: center; gap: 10px; margin: 15px 0; }
        .dice { width: 32px; height: 32px; background: white; color: black; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .session-point { font-size: 1.8rem; font-weight: bold; margin: 10px 0; color: var(--text); }
        .session-result { font-size: 1.5rem; font-weight: bold; padding: 10px; border-radius: 15px; }
        .result-tai { background: rgba(0, 255, 170, 0.15); color: var(--correct); }
        .result-xiu { background: rgba(255, 68, 119, 0.15); color: var(--wrong); }
        /* FOOTER */
        .square-footer {
            margin-top: 25px;
            text-align: center;
            color: var(--pink-light);
            font-size: 0.9rem;
            padding-top: 20px;
            border-top: 2px dashed var(--pink);
            position: relative;
            z-index: 1;
        }
        .auto-countdown {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 102, 178, 0.2);
            padding: 10px 20px;
            border-radius: 50px;
            margin-top: 15px;
        }
        .countdown-number {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--correct);
        }
        .loader {
            border: 6px solid rgba(255,102,178,0.2);
            border-top: 6px solid var(--pink);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1.5s linear infinite;
            margin: 20px auto;
            display: none;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* RESPONSIVE */
        @media (max-width: 850px) {
            .square-container { width: 95vw; height: auto; min-height: 95vh; }
            .main-content { grid-template-rows: auto auto; }
            .prediction-display { flex-direction: column; gap: 25px; }
            .history-scroll { grid-template-columns: repeat(2, 1fr); }
            .key-input-group { flex-direction: column; }
        }
        @media (max-width: 550px) {
            .history-scroll { grid-template-columns: 1fr; }
            .square-title { font-size: 2.2rem; }
            .prediction-circle { width: 150px; height: 150px; font-size: 4.5rem; }
        }
    </style>
</head>
<body>
    <div class="square-container">
        <header class="square-header">
            <h1 class="square-title">üîë LC79 KITTY SQUARE PRO</h1>
            <p class="square-subtitle">H·ªÜ TH·ªêNG KEY B·∫¢N QUY·ªÄN - T·ª∞ ƒê·ªòNG 100%</p>
            <p><i class="fas fa-server"></i> Server: api.lc79kitty.com | <i class="fas fa-key"></i> Key Required</p>
        </header>

        <!-- PH·∫¶N KEY V√Ä X√ÅC TH·ª∞C -->
        <section class="key-section">
            <h2 class="key-title"><i class="fas fa-key"></i> K√çCH HO·∫†T H·ªÜ TH·ªêNG</h2>
            <div class="key-input-group">
                <input type="text" class="key-input" id="licenseKey" 
                       placeholder="Nh·∫≠p License Key (VD: LC79-KITTY-XXXX-XXXX)" 
                       maxlength="24">
                <button class="key-button" id="activateBtn">
                    <i class="fas fa-bolt"></i> K√çCH HO·∫†T
                </button>
            </div>
            <div class="key-status">
                <div class="status-indicator">
                    <div class="status-dot status-inactive" id="statusDot"></div>
                    <div class="status-text" id="statusText">CH∆ØA K√çCH HO·∫†T</div>
                </div>
                <div style="color: var(--gold); font-size: 1.1rem;">
                    <i class="fas fa-clock"></i> H·∫øt h·∫°n: <span id="expiryDate">--/--/----</span>
                </div>
            </div>
        </section>

        <!-- N·ªòI DUNG CH√çNH (CH·ªà HI·ªÜN KHI C√ì KEY) -->
        <div class="main-content" id="mainContent" style="display: none;">
            <!-- PH·∫¶N TR√äN: D·ª∞ ƒêO√ÅN & KI·ªÇM TRA -->
            <section class="prediction-section">
                <div class="prediction-display">
                    <div class="prediction-circle" id="predictionCircle">
                        üé≤
                    </div>
                    <div class="prediction-info">
                        <div class="prediction-text" id="predictionText">
                            ƒêang kh·ªüi ƒë·ªông h·ªá th·ªëng...
                        </div>
                        <div class="prediction-reason" id="predictionReason">
                            Ch·ªù x√°c th·ª±c key th√†nh c√¥ng
                        </div>
                    </div>
                </div>
                <div class="verification-badge" id="verificationBadge">
                    <div class="verification-text" id="verificationText">
                        H·ªÜ TH·ªêNG KEY ƒêANG CH·ªú K√çCH HO·∫†T
                    </div>
                    <div id="verificationDetails">
                        <i class="fas fa-lock"></i> Vui l√≤ng nh·∫≠p key b·∫£n quy·ªÅn ƒë·ªÉ m·ªü kh√≥a to√†n b·ªô t√≠nh nƒÉng
                    </div>
                </div>
            </section>

            <!-- PH·∫¶N D∆Ø·ªöI: L·ªäCH S·ª¨ -->
            <section class="history-section">
                <h2 class="history-title">
                    <i class="fas fa-history"></i> L·ªäCH S·ª¨ T·ª∞ ƒê·ªòNG
                </h2>
                <div class="loader" id="historyLoader"></div>
                <div class="history-scroll" id="historyScroll">
                    <!-- L·ªãch s·ª≠ t·ª± ƒë·ªông th√™m v√†o ƒë√¢y -->
                </div>
            </section>
        </div>

        <footer class="square-footer">
            <p><strong>H·ªÜ TH·ªêNG B·∫¢N QUY·ªÄN LC79</strong> - Y√™u c·∫ßu key k√≠ch ho·∫°t t·ª´ server</p>
            <div class="auto-countdown" id="countdownSection">
                <i class="fas fa-robot"></i> T·ª± ƒë·ªông c·∫≠p nh·∫≠t sau: 
                <span class="countdown-number" id="countdown">--</span> gi√¢y
            </div>
            <p style="margin-top: 15px; font-size: 0.8rem; color: #ff99cc;">
                ¬© LC79 Kitty Square Pro | Server: <strong>api.lc79kitty.com</strong> | ƒê·∫°i ca: <strong>C∆∞·ªùng</strong>
            </p>
        </footer>
    </div>

    <script>
        // ==============================
        // C·∫§U H√åNH SERVER & KEY
        // ==============================
        const SERVER_URL = 'https://api.lc79kitty.com'; // Mock server URL
        const API_ENDPOINT = 'https://wtx.tele68.com/v1/tx/lite-sessions';
        const UPDATE_INTERVAL = 30000; // 30 gi√¢y
        
        // STATE
        let systemActive = false;
        let currentKey = '';
        let keyExpiry = null;
        let sessions = [];
        let lastPrediction = null;
        let updateTimer = null;
        let countdownValue = UPDATE_INTERVAL / 1000;

        // ==============================
        // MOCK SERVER API (M√î PH·ªéNG)
        // ==============================
        // ƒê√¢y l√† mock server ch·∫°y tr√™n client, th·ª±c t·∫ø s·∫Ω thay b·∫±ng server th·∫≠t
        const mockServer = {
            validateKey: async (key) => {
                // M√¥ ph·ªèng delay server
                await new Promise(resolve => setTimeout(resolve, 800));
                
                // Key h·ª£p l·ªá: LC79-KITTY-2024-PRO
                if (key === 'LC79-KITTY-2024-PRO') {
                    return {
                        success: true,
                        message: 'Key h·ª£p l·ªá! H·ªá th·ªëng ƒë√£ k√≠ch ho·∫°t.',
                        data: {
                            key: key,
                            expiry: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(), // 30 ng√†y
                            tier: 'PRO',
                            features: ['auto_predict', 'history', 'verification', 'realtime']
                        }
                    };
                }
                // Key trial
                else if (key.startsWith('LC79-TRIAL-')) {
                    return {
                        success: true,
                        message: 'Key trial ƒë√£ k√≠ch ho·∫°t (7 ng√†y).',
                        data: {
                            key: key,
                            expiry: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                            tier: 'TRIAL',
                            features: ['auto_predict', 'history']
                        }
                    };
                }
                else {
                    return {
                        success: false,
                        message: 'Key kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë√£ h·∫øt h·∫°n.'
                    };
                }
            },
            
            // Mock API c√≥ x√°c th·ª±c key
            fetchWithAuth: async (key) => {
                if (!key) throw new Error('Key ch∆∞a ƒë∆∞·ª£c cung c·∫•p');
                
                // Gi·∫£ l·∫≠p ki·ªÉm tra key tr√™n server
                if (key !== 'LC79-KITTY-2024-PRO' && !key.startsWith('LC79-TRIAL-')) {
                    throw new Error('Key kh√¥ng h·ª£p l·ªá');
                }
                
                // Fetch d·ªØ li·ªáu th·ª±c t·ª´ API g·ªëc
                const response = await fetch(API_ENDPOINT + '?t=' + Date.now());
                if (!response.ok) throw new Error('L·ªói k·∫øt n·ªëi API');
                return await response.json();
            }
        };

        // ==============================
        // KH·ªûI ƒê·ªòNG
        // ==============================
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üîê LC79 Key System ƒëang kh·ªüi ƒë·ªông...');
            
            // Ki·ªÉm tra key trong localStorage
            const savedKey = localStorage.getItem('lc79_key');
            if (savedKey) {
                document.getElementById('licenseKey').value = savedKey;
                activateSystem(savedKey);
            }
            
            // Event Listeners
            document.getElementById('activateBtn').addEventListener('click', handleActivation);
            document.getElementById('licenseKey').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleActivation();
            });
        });

        // ==============================
        // X·ª¨ L√ù K√çCH HO·∫†T KEY
        // ==============================
        async function handleActivation() {
            const keyInput = document.getElementById('licenseKey');
            const key = keyInput.value.trim().toUpperCase();
            const activateBtn = document.getElementById('activateBtn');
            
            if (!key) {
                showKeyMessage('Vui l√≤ng nh·∫≠p License Key!', 'error');
                return;
            }
            
            activateBtn.disabled = true;
            activateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ƒêANG X√ÅC TH·ª∞C...';
            
            try {
                // G·ªçi mock server ƒë·ªÉ validate key
                const result = await mockServer.validateKey(key);
                
                if (result.success) {
                    // K√≠ch ho·∫°t h·ªá th·ªëng
                    activateSystem(key, result.data);
                    showKeyMessage(result.message, 'success');
                    localStorage.setItem('lc79_key', key);
                } else {
                    showKeyMessage(result.message, 'error');
                    deactivateSystem();
                }
            } catch (error) {
                console.error('L·ªói k√≠ch ho·∫°t:', error);
                showKeyMessage('L·ªói k·∫øt n·ªëi ƒë·∫øn server!', 'error');
            } finally {
                activateBtn.disabled = false;
                activateBtn.innerHTML = '<i class="fas fa-bolt"></i> K√çCH HO·∫†T';
            }
        }

        function activateSystem(key, keyData = null) {
            systemActive = true;
            currentKey = key;
            
            // C·∫≠p nh·∫≠t UI key section
            document.getElementById('statusDot').className = 'status-dot status-active';
            document.getElementById('statusText').textContent = 'ƒê√É K√çCH HO·∫†T';
            document.getElementById('statusText').style.color = 'var(--correct)';
            
            if (keyData?.expiry) {
                keyExpiry = new Date(keyData.expiry);
                const expiryStr = keyExpiry.toLocaleDateString('vi-VN');
                document.getElementById('expiryDate').textContent = expiryStr;
            }
            
            // Hi·ªÉn th·ªã main content
            document.getElementById('mainContent').style.display = 'grid';
            document.getElementById('verificationText').innerHTML = 
                '<i class="fas fa-check-circle"></i> H·ªÜ TH·ªêNG ƒê√É S·∫¥N S√ÄNG';
            
            // B·∫Øt ƒë·∫ßu h·ªá th·ªëng t·ª± ƒë·ªông
            startAutoSystem();
            showKeyMessage(`Ch√†o m·ª´ng ƒë·∫øn v·ªõi LC79 PRO! Key: ${key}`, 'success');
        }

        function deactivateSystem() {
            systemActive = false;
            document.getElementById('statusDot').className = 'status-dot status-inactive';
            document.getElementById('statusText').textContent = 'CH∆ØA K√çCH HO·∫†T';
            document.getElementById('statusText').style.color = 'var(--wrong)';
            document.getElementById('expiryDate').textContent = '--/--/----';
            document.getElementById('mainContent').style.display = 'none';
            
            if (updateTimer) {
                clearInterval(updateTimer);
                updateTimer = null;
            }
            
            localStorage.removeItem('lc79_key');
        }

        function showKeyMessage(message, type) {
            const verificationDetails = document.getElementById('verificationDetails');
            verificationDetails.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'}"></i>
                <strong style="color: ${type === 'success' ? 'var(--correct)' : 'var(--wrong)'}">
                    ${message}
                </strong>
            `;
            
            // Hi·ªáu ·ª©ng notification
            verificationDetails.parentElement.style.animation = 'none';
            setTimeout(() => {
                verificationDetails.parentElement.style.animation = 'pulse 0.5s';
            }, 10);
        }

        // ==============================
        // H·ªÜ TH·ªêNG T·ª∞ ƒê·ªòNG SAU KHI C√ì KEY
        // ==============================
        function startAutoSystem() {
            console.log('üöÄ B·∫Øt ƒë·∫ßu h·ªá th·ªëng t·ª± ƒë·ªông v·ªõi key:', currentKey);
            startCountdown();
            runAutoCycle(); // Ch·∫°y ngay l·∫ßn ƒë·∫ßu
            updateTimer = setInterval(runAutoCycle, UPDATE_INTERVAL);
        }

        async function runAutoCycle() {
            if (!systemActive) return;
            
            showLoader(true);
            try {
                // Fetch d·ªØ li·ªáu v·ªõi x√°c th·ª±c key (qua mock server)
                const data = await mockServer.fetchWithAuth(currentKey);
                sessions = data.list || [];
                
                // C·∫≠p nh·∫≠t l·ªãch s·ª≠
                updateHistoryDisplay(sessions.slice(0, 9));
                
                // Ph√¢n t√≠ch & d·ª± ƒëo√°n
                const analysis = analyzeData(sessions);
                const prediction = makePrediction(analysis);
                
                // Hi·ªÉn th·ªã d·ª± ƒëo√°n
                updatePredictionDisplay(prediction);
                
                // Ki·ªÉm tra ƒë√∫ng/sai t·ª± ƒë·ªông
                const verification = autoVerify(sessions);
                updateVerificationDisplay(verification);
                
                // L∆∞u l·∫°i ƒë·ªÉ ki·ªÉm tra sau
                lastPrediction = { ...prediction, time: new Date() };
                
            } catch (err) {
                console.error('L·ªói auto cycle:', err);
                if (err.message.includes('Key kh√¥ng h·ª£p l·ªá')) {
                    showKeyMessage('Key ƒë√£ h·∫øt h·∫°n! Vui l√≤ng gia h·∫°n.', 'error');
                    deactivateSystem();
                }
                showErrorState();
            } finally {
                showLoader(false);
                resetCountdown();
            }
        }

        // ==============================
        // C√ÅC H√ÄM T·ª∞ ƒê·ªòNG (GI·ªêNG TR∆Ø·ªöC)
        // ==============================
        function analyzeData(sessions) {
            const recent = sessions.slice(0, 8);
            let tai = 0, xiu = 0, points = 0;
            recent.forEach(s => {
                if (s.resultTruyenThong === 'TAI') tai++; else xiu++;
                points += s.point;
            });
            return {
                tai, xiu,
                avgPoint: points / recent.length,
                lastResults: recent.slice(0,3).map(s => s.resultTruyenThong)
            };
        }

        function makePrediction(analysis) {
            const { tai, xiu, avgPoint, lastResults } = analysis;
            let outcome = 'TAI';
            let reason = '';
            
            if (xiu > tai + 1) {
                outcome = 'XIU';
                reason = `Xu h∆∞·ªõng X·ªâu (${xiu}-${tai})`;
            } else if (avgPoint < 10.2) {
                outcome = 'XIU';
                reason = `ƒêi·ªÉm TB th·∫•p (${avgPoint.toFixed(1)})`;
            } else if (avgPoint > 10.8) {
                reason = `ƒêi·ªÉm TB cao (${avgPoint.toFixed(1)})`;
            }
            
            if (lastResults.length >= 2 && lastResults[0] === lastResults[1]) {
                outcome = lastResults[0] === 'TAI' ? 'XIU' : 'TAI';
                reason = `Ph√° chu·ªói ${lastResults[0]}`;
            }
            
            if (!reason) reason = `Ph√¢n t√≠ch xu h∆∞·ªõng (${tai}-${xiu})`;
            
            return { outcome, reason };
        }

        function updatePredictionDisplay(pred) {
            const circle = document.getElementById('predictionCircle');
            const text = document.getElementById('predictionText');
            const reason = document.getElementById('predictionReason');
            
            circle.textContent = pred.outcome;
            circle.className = `prediction-circle ${pred.outcome === 'TAI' ? 'prediction-tai' : 'prediction-xiu'}`;
            text.textContent = `D·ª± ƒëo√°n: ${pred.outcome}`;
            text.style.color = pred.outcome === 'TAI' ? 'var(--correct)' : 'var(--wrong)';
            reason.textContent = `L√Ω do: ${pred.reason}`;
        }

        function updateHistoryDisplay(sessions) {
            const container = document.getElementById('historyScroll');
            container.innerHTML = '';
            
            sessions.forEach(s => {
                const isTai = s.resultTruyenThong === 'TAI';
                const item = document.createElement('div');
                item.className = `history-item ${isTai ? 'tai' : 'xiu'}`;
                item.innerHTML = `
                    <div class="session-id">#${s.id}</div>
                    <div class="session-dices">
                        ${s.dices.map(d => `<div class="dice">${d}</div>`).join('')}
                    </div>
                    <div class="session-point">${s.point}</div>
                    <div class="session-result ${isTai ? 'result-tai' : 'result-xiu'}">
                        ${isTai ? 'T√ÄI' : 'X·ªàU'}
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function autoVerify(currentSessions) {
            if (!lastPrediction || currentSessions.length < 2) {
                return { status: 'no_data', message: 'Ch∆∞a c√≥ d·ªØ li·ªáu ki·ªÉm tra' };
            }
            
            const latestResult = currentSessions[0].resultTruyenThong;
            const isCorrect = lastPrediction.outcome === latestResult;
            
            return {
                status: 'checked',
                isCorrect,
                predicted: lastPrediction.outcome,
                actual: latestResult,
                sessionId: currentSessions[1]?.id,
                dice: currentSessions[0].dices,
                point: currentSessions[0].point
            };
        }

        function updateVerificationDisplay(result) {
            const badge = document.getElementById('verificationBadge');
            const text = document.getElementById('verificationText');
            const details = document.getElementById('verificationDetails');
            
            if (result.status === 'no_data') {
                badge.className = 'verification-badge';
                text.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> ƒêANG T·∫¢I D·ªÆ LI·ªÜU...';
                details.innerHTML = 'Chu k·ª≥ ƒë·∫ßu ti√™n ƒëang ch·∫°y';
                return;
            }
            
            if (result.isCorrect) {
                badge.className = 'verification-badge verification-correct';
                text.innerHTML = `<i class="fas fa-check-circle"></i> D·ª∞ ƒêO√ÅN ƒê√öNG 100%`;
                text.style.color = 'var(--correct)';
            } else {
                badge.className = 'verification-badge verification-wrong';
                text.innerHTML = `<i class="fas fa-times-circle"></i> D·ª∞ ƒêO√ÅN CH∆ØA CH√çNH X√ÅC`;
                text.style.color = 'var(--wrong)';
            }
            
            details.innerHTML = `
                <div style="display: flex; justify-content: space-around; margin: 15px 0;">
                    <div>
                        <div style="font-size: 0.9rem;">ƒê√£ d·ª± ƒëo√°n</div>
                        <div style="font-size: 2rem; color: ${result.predicted === 'TAI' ? 'var(--correct)' : 'var(--wrong)'}">
                            ${result.predicted}
                        </div>
                    </div>
                    <div>
                        <div style="font-size: 0.9rem;">Th·ª±c t·∫ø</div>
                        <div style="font-size: 2rem; color: ${result.actual === 'TAI' ? 'var(--correct)' : 'var(--wrong)'}">
                            ${result.actual}
                        </div>
                    </div>
                </div>
                <div style="font-size: 0.9rem; color: #ccc;">
                    Phi√™n #${result.sessionId} | X√∫c x·∫Øc: [${result.dice.join(', ')}] | ƒêi·ªÉm: ${result.point}
                </div>
            `;
        }

        function showLoader(show) {
            document.getElementById('historyLoader').style.display = show ? 'block' : 'none';
        }

        function showErrorState() {
            document.getElementById('predictionCircle').textContent = '!';
            document.getElementById('predictionCircle').className = 'prediction-circle';
            document.getElementById('predictionText').textContent = 'L·ªói k·∫øt n·ªëi';
            document.getElementById('predictionText').style.color = 'var(--wrong)';
        }

        // ==============================
        // ƒê·∫æM NG∆Ø·ª¢C T·ª∞ ƒê·ªòNG
        // ==============================
        function startCountdown() {
            const countdownEl = document.getElementById('countdown');
            countdownValue = UPDATE_INTERVAL / 1000;
            countdownEl.textContent = countdownValue;
            
            window.countdownTimer = setInterval(() => {
                countdownValue--;
                countdownEl.textContent = countdownValue;
                if (countdownValue <= 0) countdownValue = UPDATE_INTERVAL / 1000;
            }, 1000);
        }

        function resetCountdown() {
            countdownValue = UPDATE_INTERVAL / 1000;
            document.getElementById('countdown').textContent = countdownValue;
        }

        // ==============================
        // D·ªåN D·∫∏P
        // ==============================
        window.addEventListener('beforeunload', () => {
            if (updateTimer) clearInterval(updateTimer);
            if (window.countdownTimer) clearInterval(window.countdownTimer);
        });
    </script>
</body>
</html>